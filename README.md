# Mini Miro Board (offline)

Небольшое офлайн-приложение на Python/Tkinter, которое имитирует базовый функционал Miro: карточки, связи между ними, рамки-группы, масштабирование, мини-карта, undo/redo и сохранение в JSON.

Приложение работает локально, без сети и аккаунтов.

---

## Возможности

### Карточки

- Создание карточек:
  - кнопка «Добавить карточку»,
  - двойной клик по пустому месту на борде.
- Перемещение карточек мышью (с поддержкой множественного выделения).
- Изменение размера:
  - тянем квадрат в правом нижнем углу карточки.
- Инлайн-редактирование текста:
  - двойной клик по карточке — открывается `Text`-редактор прямо на борде;
  - сохранение по потере фокуса, отмена по `Esc`.
- Изменение цвета:
  - кнопка «Изменить цвет» в сайдбаре,
  - пункт контекстного меню карточки (ПКМ).
- Копирование/вставка/дубликат:
  - `Ctrl+C` / `Ctrl+V` — копировать/вставить,
  - `Ctrl+D` — дубликат.
- Удаление:
  - клавиша `Delete`,
  - пункт контекстного меню.

### Множественное выделение и массовые операции

- Прямоугольное выделение (lasso):
  - ЛКМ по пустому месту + протянуть мышь.
- Выравнивание:
  - «Выровнять по левой» — выровнять X всех выбранных по левой границе первой карточки.
  - «Выровнять по верхней» — выровнять Y по верхней границе первой карточки.
- Одинаковые размеры:
  - «Одинаковая ширина» — задать ширину как у первой карточки.
  - «Одинаковая высота» — аналогично по высоте.
- Массовое изменение цвета:
  - выбрать несколько карточек,
  - «Изменить цвет» — применится ко всем выбранным.

### Связи (connections)

- Два способа создать связь:
  1. Перетянуть кружок справа от карточки на другую карточку.
  2. Включить «Режим соединения», кликнуть по первой карточке, затем по второй.
- Стрелка всегда указывает из первой карточки во вторую.
- Подпись связи:
  - двойной клик по линии или подписи,
  - ввод текста в диалоге.
- Контекстное меню связи (ПКМ по линии или подписи):
  - «Редактировать текст»
  - «Поменять направление стрелки»
  - «Удалить связь»

### Рамки / группы (frames)

- Создание рамки:
  - кнопка «Добавить рамку» (размещается в центре текущего вида).
- Перемещение рамки:
  - потянуть за рамку — двигается сама рамка и все карточки внутри неё.
- Сворачивание/разворачивание:
  - кнопка «Свернуть/развернуть рамку» в сайдбаре (по текущей выбранной рамке),
  - контекстное меню рамки.
- Переименование и удаление:
  - ПКМ по рамке → «Переименовать», «Удалить рамку».

### Сетка и привязка

- Сетка отрисовывается на всём холсте.
- Настройки в сайдбаре:
  - чекбокс «Привязка к сетке»;
  - «Шаг сетки (px)» — изменяемый через `Spinbox`;
  - чекбокс «Показывать сетку».
- При перемещении/ресайзе карточки, по отпускании кнопки мыши координаты привязываются к сетке (если включена привязка).

### Навигация и вид

- Масштабирование:
  - колесо мыши над бордом (увеличение/уменьшение).
- Панорамирование:
  - средняя кнопка мыши (колесо) — зажать и тянуть.
- Мини-карта:
  - отображает борд, рамки и карточки;
  - прямоугольник обзора показывает, какая часть борда видна;
  - клик по мини-карте переносит область просмотра.
- Темы:
  - светлая / тёмная;
  - переключение кнопкой «Тёмная тема / Светлая тема» в сайдбаре.

### Работа с файлами

- Сохранение / загрузка доски:
  - формат JSON (координаты, размеры, цвет, текст карточек, связи, рамки);
  - диалоги «Сохранить…» / «Загрузить…».
- Автосохранение:
  - состояние периодически пишетcя в `_mini_miro_autosave.json`;
  - при запуске приложение предлагает восстановиться.
- Экспорт в PNG:
  - требует установленный пакет `Pillow`;
  - экспортирует текущий борд (карточки, рамки, связи и подписи).

### Вложения изображений

- Метаданные вложения (хранятся в карточке, поле `attachments`):
  - `id` — локальный идентификатор вложения внутри карточки;
  - `name` — имя файла/ресурса для отображения в UI;
  - `source_type` — `"file"` (загружено с диска) или `"clipboard"` (вставка из буфера);
  - `mime_type` — MIME (например, `image/png` или `image/jpeg`);
  - `width`/`height` — пиксельные размеры исходного изображения;
  - `offset_x`/`offset_y` — смещение изображения относительно центра карточки (для позиционирования превью возле задачи);
  - `storage_path` — относительный путь к бинарным данным изображения.
- Хранение бинарных данных: только на диске по относительным путям (без base64 в `*_autosave.json`). При сохранении/вставке изображение кладётся, например, в `attachments/<card_id>-<attachment_id>.png`, а JSON содержит лишь `storage_path`.
- Пример блока карточки в JSON:

```json
{
  "id": 42,
  "text": "Задача",
  "attachments": [
    {
      "id": 1,
      "name": "screenshot.png",
      "source_type": "clipboard",
      "mime_type": "image/png",
      "width": 800,
      "height": 600,
      "offset_x": 12,
      "offset_y": -8,
      "storage_path": "attachments/42-1.png"
    }
  ]
}
```

### Undo / Redo

- История реализована через слой команд (`SnapshotCommand`):
  - каждая команда хранит состояние ДО и ПОСЛЕ;
  - `Ctrl+Z` — Undo;
  - `Ctrl+Y` — Redo.

---

## Горячие клавиши

- `Ctrl+Z` / `Ctrl+Y` — отмена / повтор.
- `Ctrl+C` / `Ctrl+V` — копировать / вставить.
- `Ctrl+D` — дублировать выбранные карточки.
- `Delete` — удалить выбранные карточки.
- Колесо мыши — зум.
- Средняя кнопка мыши — панорамирование.
- ПКМ — контекстное меню (карточка/связь/рамка).

---

## Установка и запуск

### Требования

- Python 3.10+ (рекомендуется)
- Tkinter (обычно входит в стандартную поставку Python)
- `Pillow` — для экспорта в PNG

### Установка

```bash
git clone https://github.com/USERNAME/mini-miro-board.git
cd mini-miro-board

python -m venv .venv
# Linux/macOS:
source .venv/bin/activate
# Windows:
# .venv\Scripts\activate

pip install -r requirements.txt
